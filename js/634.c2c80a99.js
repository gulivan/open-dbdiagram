"use strict";(globalThis["webpackChunkdbdiagram_oss"]=globalThis["webpackChunkdbdiagram_oss"]||[]).push([[634],{2634:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ra});var l=a(9835),n=a(499);const i={ref:"root",class:"dbml-editor-wrapper"};function s(e,t,a,n,s,o){const r=(0,l.up)("v-ace-editor");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(r,{class:"dbml-editor",lang:"dbml",theme:n.theme,value:n.sourceCode,"onUpdate:value":t[0]||(t[0]=e=>n.sourceCode=e),"print-margin":!1,options:n.options,onInit:n.editorInit},null,8,["theme","value","options","onInit"])],512)}var o=a(171),r=a(5424),d=a(9684);class u{constructor(e,t){this.session=e,this.info=t,this.type=t.type,this.row=t.row,this.text=t.text||t.message||void 0,this.startAnchor=e.getDocument().createAnchor(t.row,t.column),this.endAnchor=e.getDocument().createAnchor(t.endRow||t.row,t.endColumn),this.startAnchor.on("change",this.update.bind(this)),this.endAnchor.on("change",this.update.bind(this)),this.marker=null,this.update()}update(){console.log("update",this);const e=d.Range.fromPoints(this.startAnchor.getPosition(),this.endAnchor.getPosition());this.marker&&this.session.removeMarker(this.marker),this.marker=this.session.addMarker(e,`marker-highlight-${this.info.type}`,"text")}remove(){this.startAnchor.detach(),this.endAnchor.detach(),this.marker&&this.session.removeMarker(this.marker)}}const c={name:"DbmlEditor",components:{VAceEditor:o.m},props:["source"],setup(e,{emit:t}){let a=null;const i=(0,r.E)(),s=(0,n.iH)({markerId:null,errorMarkerId:null}),o=(0,n.qj)([]),c=(0,l.Fl)({get:()=>e.source,set:e=>t("update:source",e)}),h=(0,l.Fl)({get:()=>i.getTheme,set:e=>i.updateTheme(e)}),p=(e,t)=>{s.value.markerId&&(a.session.removeMarker(s.value.markerId),s.value.markerId=null);const l=new d.Range(e.row-1,e.col-1,t.row-1,t.col-1);a.focus(),a.clearSelection(),a.scrollToLine(e.row-1),a.moveCursorTo(e.row-1,e.col-1),s.value.markerId=a.session.addMarker(l,"ace_active-line","text"),console.log("highlightTokenRange",s.value.markerId,e,t)},v=e=>{a=e},m=(0,n.iH)({useWorker:!1,tabSize:2,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,showPrintMargin:!1}),g=i.$subscribe(((e,t)=>{if("editor"===e.storeId&&e.payload){if(e.payload.source&&e.payload.source.markers&&e.payload.source.markers.selection){const e=i.source.markers.selection,t=e.start,a=e.end;p({row:t.line,col:t.column},{row:a.line,col:a.column})}if("parserError"in e.payload){for(const e of o)e.remove();if(a.session.clearAnnotations(),s.value.errorMarkerId&&(a.session.removeMarker(s.value.errorMarkerId),s.value.errorMarkerId=null),e.payload.parserError){const e=t.parserError,l=[new u(a.session,{text:e.message,type:e.type,row:e.location.start.row,column:e.location.start.col,endRow:e.location.end.row,endColumn:e.location.end.col})];o.push(...l),a.session.setAnnotations(l)}}}}));return{currentMarkerRef:s,sourceCode:c,theme:h,options:m,highlightTokenRange:p,editorInit:v,subscription:g}}};var h=a(1639);const p=(0,h.Z)(c,[["render",s],["__scopeId","data-v-bf861e52"]]),v=p;var m=a(6970),g=a(1957);const b={class:"text-subtitle2 db-tip-highlights"},y={key:0},_={key:1,class:"db-tip-highlights"},w=(0,l._)("span",{class:"enum-class"},"ENUM ",-1),f={class:"enum-type"},x={key:2,class:"db-tip-highlights"},k={class:"enum-value"},D=(0,l._)("span",{class:"enum-value_tab"},"* ",-1),q={class:"enum-value_name"},P={key:0,class:"enum-value_note"},M={key:3,class:"db-tip-highlights"},C=(0,l._)("span",{class:"enum-class"},"DEFAULT ",-1),S={class:"enum-type"},T={key:4,class:"db-tip-highlights"},E=(0,l._)("span",{class:"enum-class"},"INCREMENT",-1),j=[E],z={__name:"VDbFieldTooltip",props:{field:Object},setup(e){return(t,a)=>{const n=(0,l.up)("q-card-section"),i=(0,l.up)("q-separator");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(n,{style:{padding:"8px 8px"}},{default:(0,l.w5)((()=>[(0,l._)("div",b,[(0,l.Uk)((0,m.zw)(e.field.name)+" ",1),(0,l._)("span",{class:(0,m.C_)({"enum-type":e.field._enum,"general-type":!e.field._enum})},(0,m.zw)(e.field.type.type_name),3)])])),_:1}),(0,l.Wm)(i),(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[e.field.note?((0,l.wg)(),(0,l.iD)("div",y,"Note: "+(0,m.zw)(e.field.note),1)):(0,l.kq)("",!0),e.field._enum?((0,l.wg)(),(0,l.iD)("div",_,[w,(0,l._)("span",f,(0,m.zw)(e.field._enum.name)+":",1)])):(0,l.kq)("",!0),e.field._enum?((0,l.wg)(),(0,l.iD)("div",x,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.field._enum.values,(e=>((0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",k,[D,(0,l._)("span",q,(0,m.zw)(e.name),1),e.note?((0,l.wg)(),(0,l.iD)("span",P,[(0,l.Uk)(" ["),(0,l._)("i",null,(0,m.zw)(e.note),1),(0,l.Uk)("]")])):(0,l.kq)("",!0)])])))),256))])):(0,l.kq)("",!0),e.field.dbdefault?((0,l.wg)(),(0,l.iD)("div",M,[C,(0,l._)("span",S,(0,m.zw)(e.field.dbdefault.value),1)])):(0,l.kq)("",!0),e.field.increment?((0,l.wg)(),(0,l.iD)("div",T,j)):(0,l.kq)("",!0)])),_:1})],64)}}};var H=a(3190),$=a(926),Z=a(9984),U=a.n(Z);const R=z,L=R;U()(z,"components",{QCardSection:H.Z,QSeparator:$.Z});var O=a(1474);const A=["id","x","y","width","height"],Y=["height","width"],W=["y"],F=["x","y"],N=(0,l._)("path",{d:"M280-400q-33 0-56.5-23.5T200-480q0-33 23.5-56.5T280-560q33 0 56.5 23.5T360-480q0 33-23.5 56.5T280-400Zm0 160q-100 0-170-70T40-480q0-100 70-170t170-70q67 0 121.5 33t86.5 87h352l120 120-180 180-80-60-80 60-85-60h-47q-32 54-86.5 87T280-240Zm0-80q56 0 98.5-34t56.5-86h125l58 41 82-61 71 55 75-75-40-40H435q-14-52-56.5-86T280-640q-66 0-113 47t-47 113q0 66 47 113t113 47Z"},null,-1),B=[N],I=["x","y"],Q=(0,l._)("path",{d:"M200-200h360v-200h200v-360H200v560Zm0 80q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v400L600-120H200Zm80-280v-80h200v80H280Zm0-160v-80h400v80H280Zm-80 360v-560 560Z"},null,-1),G=[Q],V=["x","y"],K=["x"],X=["x","y"],J=["x"],ee=["x","y"],te={__name:"VDbField",props:{id:Number,selection:String,token:Object,name:String,type:Object,unique:Boolean,pk:Boolean,dbState:Object,not_null:Boolean,note:String,dbdefault:Object,increment:Boolean,width:Number,table:Object,endpoints:Array,_enum:Object,indexPk:Boolean},setup(e){const t=e,a=(0,n.iH)(null),i=(0,O.g)(),s=(0,l.Fl)((()=>({width:t.width,height:30}))),o=(0,l.Fl)((()=>({name_width:6*t.name.length+16}))),r=e=>{a.value&&(o.value.name_width=7*e.length,o.value.name_width=o.value.name_width+4)};(0,l.YP)((()=>t.name),(e=>{r(e)}));const d=(0,l.Fl)((()=>{let e=0,a=0,l=0;return t._enum&&(e+=13,a+=8),t.not_null&&(e+=23,a+=30,l+=18),{main_shift:e,enum_rect_shift:a,nn_rect_shift:l}})),u=(0,l.Fl)((()=>({x:0,y:35+30*t.table.fields.findIndex((e=>e.id===t.id))}))),c=()=>{const e=i.getTable(t.table.id),a={x:u.value.x+s.value.width+e.x,y:u.value.y+e.y};i.showTooltip(a,L,{field:t})},h=((0,l.bv)((()=>{})),(0,n.iH)(!1)),p=(0,n.iH)(!1),v=e=>{h.value=!0,(t.note||t._enum||t.dbdefault)&&c()},g=e=>{h.value=!1,p.value=!1,i.hideTooltip()},b=e=>{p.value=!1},y=e=>{p.value=!0};return(n,i)=>((0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:a,id:`field-${e.id}`,class:(0,m.C_)({"db-field":!0,"db-field__highlight":h.value,"db-field__dragging":p.value,"db-field__pk":e.pk||t.indexPk,"db-field__unique":e.unique,"db-field__not_null":e.not_null,"db-field__increment":e.increment,"db-field__ref":e.endpoints.length>0}),x:u.value.x,y:u.value.y,width:s.value.width,height:s.value.height,onMousedownPassive:y,onMouseupPassive:b,onMouseenterPassive:v,onMouseleavePassive:g},[(0,l._)("rect",{height:s.value.height,width:s.value.width},null,8,Y),(0,l._)("text",{class:"db-field__name",y:s.value.height/2},(0,m.zw)(e.name),9,W),e.pk||t.indexPk?((0,l.wg)(),(0,l.iD)("svg",{key:0,class:"db-field__pk-icon",xmlns:"http://www.w3.org/2000/svg",height:"16",viewBox:"0 -960 960 960",width:"16",x:o.value.name_width+8,y:s.value.height/4},B,8,F)):(0,l.kq)("",!0),e._enum||e.note||e.dbdefault?((0,l.wg)(),(0,l.iD)("svg",{key:1,xmlns:"http://www.w3.org/2000/svg",class:"db-field__note-icon",height:"16",viewBox:"0 -960 960 960",width:"16",x:e.pk||t.indexPk?o.value.name_width+24:o.value.name_width+8,y:s.value.height/4},G,8,I)):(0,l.kq)("",!0),(0,l._)("text",{class:"db-field__type",x:s.value.width-d.value.main_shift,y:s.value.height/2},(0,m.zw)(e.type.type_name),9,V),e._enum?((0,l.wg)(),(0,l.iD)("rect",{key:2,class:"db-field__type-ads-rect",x:s.value.width-d.value.enum_rect_shift,y:"2",height:"18",width:"9",rx:"2"},null,8,K)):(0,l.kq)("",!0),e._enum?((0,l.wg)(),(0,l.iD)("text",{key:3,class:"db-field__type-ads",x:e.not_null?s.value.width-22:s.value.width,y:s.value.height/2},"E",8,X)):(0,l.kq)("",!0),e.not_null?((0,l.wg)(),(0,l.iD)("rect",{key:4,class:"db-field__type-ads-rect",x:s.value.width-d.value.nn_rect_shift,y:"2",height:"18",width:"20",rx:"2"},null,8,J)):(0,l.kq)("",!0),e.not_null?((0,l.wg)(),(0,l.iD)("text",{key:5,class:"db-field__type-ads",x:s.value.width,y:s.value.height/2},"NN",8,ee)):(0,l.kq)("",!0),(0,l._)("title",null,(0,m.zw)(e.name)+" ("+(0,m.zw)(e.type.type_name)+" "+(0,m.zw)(e._enum?"is Enum":null)+")",1)],42,A))}},ae=te,le=ae,ne={class:"text-subtitle2"},ie={key:0},se={key:1},oe=(0,l._)("div",{class:"text-caption"},[(0,l._)("b",null,"Indexes")],-1),re={class:"db-tip-highlights"},de={key:0},ue={key:0},ce={key:1,class:"enum-value_name"},he={key:1,class:"db-tip-highlights"},pe=(0,l._)("span",{class:"enum-class"},"ID: ",-1),ve={key:0},me=(0,l._)("span",{class:"enum-class"}," spec: ",-1),ge={key:1},be={key:2},ye={key:3},_e={class:"db-tip-highlights"},we=(0,l._)("span",{class:"enum-class"},"columns: ",-1),fe={key:2,class:"db-tip-highlights"},xe=(0,l._)("span",{class:"enum-class"},"note: ",-1),ke={__name:"VDbTableTooltip",props:{table:Object},setup(e){return(t,a)=>{const n=(0,l.up)("q-card-section"),i=(0,l.up)("q-separator"),s=(0,l.up)("q-list");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(n,{style:{padding:"8px 8px"}},{default:(0,l.w5)((()=>[(0,l._)("div",ne,(0,m.zw)(e.table.name),1)])),_:1}),(0,l.Wm)(i),e.table.note||e.table.alias?((0,l.wg)(),(0,l.j4)(n,{key:0},{default:(0,l.w5)((()=>[e.table.note?((0,l.wg)(),(0,l.iD)("div",ie,"Note: "+(0,m.zw)(e.table.note),1)):(0,l.kq)("",!0),e.table.alias?((0,l.wg)(),(0,l.iD)("div",se,"Alias: "+(0,m.zw)(e.table.alias),1)):(0,l.kq)("",!0)])),_:1})):(0,l.kq)("",!0),e.table.indexes.length>0?((0,l.wg)(),(0,l.j4)(n,{key:1},{default:(0,l.w5)((()=>[oe,(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.table.indexes,(e=>((0,l.wg)(),(0,l.iD)("div",re,[e.name||e.type?((0,l.wg)(),(0,l.iD)("div",de,[e.name?((0,l.wg)(),(0,l.iD)("span",ue,(0,m.zw)(e.name),1)):(0,l.kq)("",!0),e.type?((0,l.wg)(),(0,l.iD)("span",ce,":["+(0,m.zw)(e.type)+"]",1)):(0,l.kq)("",!0)])):(0,l.kq)("",!0),e.pk||e.unique?((0,l.wg)(),(0,l.iD)("div",he,[pe,e.id?((0,l.wg)(),(0,l.iD)("span",ve,(0,m.zw)(e.id),1)):(0,l.kq)("",!0),me,e.pk?((0,l.wg)(),(0,l.iD)("span",ge,"PK")):(0,l.kq)("",!0),e.pk&&e.unique?((0,l.wg)(),(0,l.iD)("span",be,"|")):(0,l.kq)("",!0),e.unique?((0,l.wg)(),(0,l.iD)("span",ye,"UNIQUE")):(0,l.kq)("",!0)])):(0,l.kq)("",!0),(0,l._)("div",_e,[we,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.columns,(t=>((0,l.wg)(),(0,l.iD)("span",null,[(0,l._)("span",{class:(0,m.C_)({"enum-type":"expression"==t.type,"general-type":"column"==t.type})},(0,m.zw)(t.value),3),(0,l.Uk)((0,m.zw)(t==e.columns[e.columns.length-1]?"":", "),1)])))),256))]),e.note?((0,l.wg)(),(0,l.iD)("div",fe,[xe,(0,l._)("span",null,(0,m.zw)(e.note),1)])):(0,l.kq)("",!0)])))),256))])),_:1})])),_:1})):(0,l.kq)("",!0)],64)}}};var De=a(3246);const qe=ke,Pe=qe;function Me(e,t){return Math.round(e/t)*t}function Ce(e,t){return console.log("snap",e,t),"number"===typeof e?Me(e,t):"x"in e&&"y"in e?(e.x=Me(e.x),e.y=Me(e.y),e):e}U()(ke,"components",{QCardSection:H.Z,QSeparator:$.Z,QList:De.Z});const Se=(0,l._)("div",{class:"text-subtitle2"},"Colors",-1),Te={class:"row"},Ee=(0,l._)("div",{class:"col-md-2"},[(0,l._)("div",{class:"text-subtitle4"},"Default:")],-1),je={class:"col-md-2 offset-md-2"},ze={class:"db-tooltip__colorblock"},He={class:"q-pa-xs col"},$e={class:"db-tooltip__colorblock"},Ze=["onClickPassive","onTouchendPassive"],Ue={__name:"VDbHeadColorTip",props:{table:Object},emits:["click:color-block"],setup(e,{emit:t}){const a=e,i=(0,n.iH)(null),s=[["#1E69FD","#4B82B0","#121212","#24BAB1","#126E7A"],["#2D6512","#79AD51","#E4A62E","#EB801B","#8F8DD8"],["#990D0D","#CA4242","#DE65C3","#6724BB","#A15CF5"]],o=(e,l)=>{t("click:color-block",e,a.table.id,a.table.name,l,a.table.schema.name)};return(e,t)=>{const a=(0,l.up)("q-card-section");return(0,l.wg)(),(0,l.j4)(a,{style:{padding:"8px 8px"}},{default:(0,l.w5)((()=>[Se,(0,l._)("div",Te,[Ee,(0,l._)("div",je,[(0,l._)("rect",ze,[(0,l._)("rect",{class:"db-tooltip__colorblock db-tooltip__colorblock-default",style:(0,m.j5)({background:e.cl,height:"1.4em",width:"1.4em"}),onClickPassive:t[0]||(t[0]=e=>o(e,null)),onTouchendPassive:t[1]||(t[1]=e=>o(e,null))},null,36)])])]),(0,l._)("div",He,[((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)(s,(e=>(0,l._)("div",{class:"row",ref_for:!0,ref_key:"cp",ref:i,style:{padding:"4px 6px"}},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e,(e=>((0,l.wg)(),(0,l.iD)("div",{key:e,style:{padding:"4px 6px"}},[(0,l._)("rect",$e,[(0,l._)("rect",{class:"db-tooltip__colorblock",style:(0,m.j5)({background:e,height:"1.4em",width:"1.4em"}),onClickPassive:t=>o(t,e),onTouchendPassive:t=>o(t,e)},null,44,Ze)])])))),128))],512))),64))])])),_:1})}}},Re=Ue,Le=Re;U()(Ue,"components",{QCardSection:H.Z});var Oe=a(899);const Ae=["id","x","y","width","height"],Ye=["width","height"],We=["width","fill"],Fe={class:"db-table-header__name",y:"16"},Ne=["fill","x"],Be=["x"],Ie=(0,l._)("path",{d:"m247-904 57-56 343 343q23 23 23 57t-23 57L457-313q-23 23-57 23t-57-23L153-503q-23-23-23-57t23-57l190-191-96-96Zm153 153L209-560h382L400-751Zm360 471q-33 0-56.5-23.5T680-360q0-21 12.5-45t27.5-45q9-12 19-25t21-25q11 12 21 25t19 25q15 21 27.5 45t12.5 45q0 33-23.5 56.5T760-280ZM80 0v-160h800V0H80Z"},null,-1),Qe=[Ie],Ge={class:"db-table-fields"},Ve={__name:"VDbTable",props:{id:Number,selection:String,token:Object,group:Object,name:String,alias:String,note:String,indexes:Array,schema:Object,headerColor:{type:String,default:()=>""},dbState:Object,fields:{type:Array,default:()=>[]},containerRef:Object,useSchema:{type:Boolean,default:()=>{}}},emits:["update:position","click:header","click:field"],setup(e,{emit:t}){const a=e,i=(0,r.E)(),s=(0,O.g)(),o=(0,l.Fl)((()=>s.getTable(a.id))),d=(0,l.Fl)((()=>s.getTableColor(a.name,a.id,a.schema.name).color)),u=(0,n.iH)(null),c=()=>{if(!u.value)return;const e=[...u.value.querySelectorAll(".db-field")],t=e.map((e=>[...e.querySelectorAll("text")].map((e=>e.getComputedTextLength())).reduce(((e,t)=>e+t),48))).reduce(((e,t)=>Math.max(e,t)),0),a=1.28*u.value.querySelectorAll(".db-table-header__name")[0].getComputedTextLength(),l=Math.max(t,a);o.value.width=Ce(Math.max(200,l),x)+20},h=()=>{o.value.height=35+30*a.fields.length},p=e=>a.indexes.filter((t=>t.columns.filter((t=>"column"==t.type&&t.value==e.name)).length>0&&t.pk)).length>0;(0,l.YP)((()=>a.useSchema),(e=>{c(),s.updateTable(a.id,o.value)})),(0,l.YP)((()=>a.name),(e=>{c(),s.updateTable(a.id,o.value)})),(0,l.YP)((()=>a.fields),(e=>{h(),c(),s.updateTable(a.id,o.value)})),(0,l.bv)((()=>{h(),c(),s.updateTable(a.id,o.value)}));(0,l.Fl)((()=>({width:200,height:35+30*a.fields.length})));const v=(0,n.iH)(!1),b=(0,n.iH)(!1),y=((0,n.iH)(!1),(0,n.iH)(!1)),_=(0,n.iH)(null),w=(0,n.iH)(null),f=(0,n.iH)(null),x=(s.subGridSize,s.grid.snap),k=e=>{v.value=!0},D=e=>{v.value=!1,y.value=!1},q=({offsetX:e,offsetY:a})=>{const l=s.inverseCtm.transformPoint({x:e,y:a});o.value.x=Ce(l.x-_.value,x),o.value.y=Ce(l.y-w.value,x),t("update:position",o.value)},P=e=>{y.value=!1,v.value=!1,_.value=null,w.value=null,a.containerRef.removeEventListener("mousemove",q,{passive:!0}),a.containerRef.removeEventListener("mouseup",P,{passive:!0}),a.containerRef.removeEventListener("mouseleave",D,{passive:!0})},M=({offsetX:e,offsetY:t})=>{y.value=!0;const l=s.inverseCtm.transformPoint({x:e,y:t});_.value=l.x-o.value.x,w.value=l.y-o.value.y,f.value=a.containerRef.createSVGPoint(),a.containerRef.addEventListener("mousemove",q,{passive:!0}),a.containerRef.addEventListener("mouseup",P,{passive:!0}),a.containerRef.addEventListener("mouseleave",D,{passive:!0})},C=()=>{b.value=!0;const e={x:o.value.x+o.value.width,y:o.value.y};s.showTooltip(e,Pe,{table:a})},S=()=>{const e={x:o.value.x+o.value.width,y:o.value.y};s.showPanel(e,Le,{table:a})},T=()=>{b.value=!1,s.hideTooltip()};function E(e){S(),console.log("show panel",`header color >${a.headerColor}<`),t("click:header",e,i.findTable(a.id))}function j(e,a){t("click:field",e,a)}const z=(0,Oe.Z)(((e,a)=>{o.x=e,o.y=a,t("update:position",{x:e,y:a})}),16);return(0,l.YP)((()=>a.x),(e=>{z(e,o.y)})),(0,l.YP)((()=>a.y),(e=>{z(o.x,e)})),(t,a)=>{const i=(0,l.Q2)("touch-hold");return(0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:u,id:`table-${e.id}`,class:(0,m.C_)({"db-table":!0,"db-table__highlight":v.value,"db-table__dragging":y.value}),x:o.value.x,y:o.value.y,width:o.value.width,height:o.value.height,onMouseenterPassive:k,onMouseleavePassive:D},[(0,l._)("rect",{class:"db-table__background",width:o.value.width,height:o.value.height},null,8,Ye),(0,l.wy)(((0,l.wg)(),(0,l.iD)("g",{class:"db-table-header",onMousedownPassive:M,onTouchend:T,onMouseenterPassive:C,onMouseleavePassive:T},[(0,l._)("rect",{height:"35",width:o.value.width,fill:""==e.headerColor?d.value:e.headerColor},null,8,We),(0,l._)("text",Fe,(0,m.zw)(e.useSchema?e.schema.name+".":"")+(0,m.zw)(e.name),1),(0,l.wy)((0,l._)("g",{class:"db-table-header__color-icon",onClickPassive:E,onTouchendPassive:E},[(0,l._)("rect",{class:"db-table-header__icon-bg",fill:""==e.headerColor?d.value:e.headerColor,x:o.value.width-25,y:"0",height:"35",width:"20"},null,8,Ne),((0,l.wg)(),(0,l.iD)("svg",{class:"db-table-header__icon",xmlns:"http://www.w3.org/2000/svg",x:o.value.width-25,y:"8",height:"20",viewBox:"0 -960 960 960",width:"20"},Qe,8,Be))],544),[[g.F8,b.value]])],32)),[[i,C]]),(0,l._)("g",Ge,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.fields,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(le),(0,l.dG)(e,{indexPk:p(e),key:e.id,width:o.value.width,onClickPassive:t=>j(t,e)}),null,16,["indexPk","width","onClickPassive"])))),128))])],42,Ae)}}};var Ke=a(1600);const Xe=Ve,Je=Xe;U()(Ve,"directives",{TouchHold:Ke.Z});const et=(0,l._)("div",{class:"text-subtitle2"},"Ref actions",-1),tt={class:"row"},at={__name:"VDbRefActions",props:{data:Object,wpid:Number,click:Object},emits:["click:ref-cp"],setup(e,{emit:t}){const a=e;function n(e,l){console.log(e,l,a),t("click:ref-cp",e,l,a.click,a.wpid,a.data.id)}return(e,t)=>{const a=(0,l.up)("q-icon"),i=(0,l.up)("q-item-section"),s=(0,l.up)("q-item"),o=(0,l.up)("q-list"),r=(0,l.up)("q-card-section"),d=(0,l.Q2)("ripple");return(0,l.wg)(),(0,l.j4)(r,{style:{padding:"8px 8px"}},{default:(0,l.w5)((()=>[et,(0,l._)("div",tt,[(0,l.Wm)(o,{dense:"",class:"db-tooltip_panel__list"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.j4)(s,{clickable:"",onClickPassive:t[0]||(t[0]=e=>n(e,"RESET"))},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(a,{color:"primary",name:"refresh"})])),_:1}),(0,l.Wm)(i,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Reset waypoints")])),_:1})])),_:1})),[[d]]),(0,l.wy)(((0,l.wg)(),(0,l.j4)(s,{clickable:"",onClickPassive:t[1]||(t[1]=e=>n(e,"ADD"))},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(a,{color:"primary",name:"add"})])),_:1}),(0,l.Wm)(i,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Add waypoint")])),_:1})])),_:1})),[[d]]),(0,l.wy)(((0,l.wg)(),(0,l.j4)(s,{clickable:"",onClickPassive:t[2]||(t[2]=e=>n(e,"DEL"))},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(a,{color:"primary",name:"delete"})])),_:1}),(0,l.Wm)(i,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Remove waypoint")])),_:1})])),_:1})),[[d]])])),_:1})])])),_:1})}}};var lt=a(490),nt=a(6749),it=a(2857),st=a(1136);U()(at,"components",{QCardSection:H.Z,QList:De.Z,QItem:lt.Z,QItemSection:nt.Z,QIcon:it.Z}),U()(at,"directives",{Ripple:st.Z});const ot=["id"],rt=["d"],dt=["d"],ut=["x","y"],ct=["x","y"],ht={__name:"VDbRef",props:{id:Number,name:String,endpoints:Array,onUpdate:[String,Object,void 0],onDelete:[String,Object,void 0],schema:Object,dbState:Object,database:Object,token:Object,containerRef:Object},emits:["click:ref"],setup(e,{emit:t}){const a=e,i=(0,O.g)();let s=i.getRef(a.id);i.subGridSize,i.grid.snap;const o=(0,n.iH)(!1),r=(0,n.iH)([]),d=((0,n.iH)(""),e=>{const t=i.getTable(e.fields[0].table.id),a=e.fields[0].table.fields.findIndex((t=>t.id===e.fields[0].id));return[{x:t.x,y:t.y+35+30*a+15},{x:t.x+t.width,y:t.y+35+30*a+15}]}),u=(e,t)=>{const a=e.flatMap((e=>t.map((t=>({distanceXY:{x:e.x-t.x,y:e.y-t.y},distance:Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),a:e,b:t})))));let l=a[0];for(const n of a)n.distance<l.distance&&(l=n);return[l.a,l.b]},c=(0,l.Fl)((()=>(console.log("start anchor",a.endpoints[0]),d(a.endpoints[0])))),h=(0,l.Fl)((()=>d(a.endpoints[1]))),p=(0,l.Fl)((()=>(s.vertices.length&&!s.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y)))||b(),!s.vertices.length||s.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y)))?[]:s.vertices))),v=(e,t)=>{let a={l:!1,r:!1},l={},n={};l=e.length?{x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2}:e,n=t.length?{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}:t;let i=57.2958*Math.atan2(l.y-n.y,l.x-n.x);return a.l=Math.abs(i)<10||Math.abs(i)<45,a.r=Math.abs(i)>170||Math.abs(i)>135,a.t=i>0&&Math.abs(i)>45&&Math.abs(i)<135,a.b=i<0&&Math.abs(i)>45&&Math.abs(i)<135,a},g=(0,l.Fl)((()=>{let e=u(c.value,h.value);v(c.value,h.value);const t=v(c.value,p.value[0]),l=v(h.value,p.value[1]);let n={x0:0,y0:0,x1:0,y1:0};return t.l&&(n.x0=-5,n.y0=-10,e[0]=c.value[0]),t.r&&(n.x0=30,n.y0=-10,e[0]=c.value[1]),l.l&&(n.x1=-5,n.y1=-10,e[1]=h.value[0]),l.r&&(n.x1=30,n.y1=-10,e[1]=h.value[1]),{start:{pos:{x:e[0].x+n.x0,y:e[0].y+n.y0},rel:a.endpoints[0].relation,ismany:"*"==a.endpoints[0].relation},end:{pos:{x:e[1].x+n.x1,y:e[1].y+n.y1},rel:a.endpoints[1].relation,ismany:"*"==a.endpoints[1].relation}}})),b=()=>{const e=c.value,t=h.value;if(!s.vertices.length||s.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y))))s.auto=!0;else if(!s.auto)return;const[a,l]=u(e,t),n=l.x-a.x,i=l.y-a.y,o=Math.sqrt(n*n+i*i),r=Math.min(.2*o,50),d=(a.x+l.x)/2,p=(a.y+l.y)/2;s.vertices=[{x:d,y:p-r},{x:d,y:p-r}]},y=(0,l.Fl)((()=>{const e=c.value,t=h.value,[a,l]=u(e,t),n={x:(a.x+l.x)/2,y:a.y},i={x:(a.x+l.x)/2,y:l.y};let s=`M ${a.x},${a.y} `;return s+=`L ${a.x-10},${a.y} `,s+=`M ${a.x},${a.y-5} `,s+=`L ${a.x-10},${a.y} `,s+=`M ${a.x},${a.y+5} `,s+=`L ${a.x-10},${a.y} `,s+=`C ${n.x},${n.y} ${i.x},${i.y} ${l.x},${l.y}`,s})),_=e=>{o.value=!0},w=e=>{o.value=!1};return(0,l.bv)((()=>{r.value=a.endpoints.map((e=>i.getTable(e.fields[0].table.id))),(0,l.Y3)((()=>{b()}))})),(0,l.YP)((()=>a.id),(e=>{s=i.getRef(e)})),(0,l.YP)(a.endpoints,(()=>{r.value=a.endpoints.map((e=>i.getTable(e.fields[0].table.id)))}),{deep:!0}),(0,l.YP)(r,(()=>{b()}),{deep:!0}),(t,a)=>((0,l.wg)(),(0,l.iD)("g",{ref:"root",id:`ref-${e.id}`,class:(0,m.C_)({"db-ref":!0,"db-ref__highlight":o.value}),onMouseenterPassive:_,onMouseleavePassive:w},[(0,l._)("path",{class:"db-ref__hitbox",d:y.value},null,8,rt),(0,l._)("path",{class:"db-ref__path",d:y.value},null,8,dt),(0,l._)("text",{class:(0,m.C_)({"db-field__type":!0,"db-ref__many-ref":g.value.start.ismany}),x:g.value.start.pos.x,y:g.value.start.pos.y},(0,m.zw)(g.value.start.rel),11,ut),(0,l._)("text",{class:(0,m.C_)({"db-field__type":!0,"db-ref__many-ref":g.value.end.ismany}),x:g.value.end.pos.x,y:g.value.end.pos.y},(0,m.zw)(g.value.end.rel),11,ct)],42,ot))}},pt=ht,vt=pt;var mt=a(6397),gt=a.n(mt);const bt=["x","y"],yt={x:"0",y:"0",width:"100%",height:"100%",class:"db-tooltip__content"},_t={__name:"VDbTooltip",setup(e){const t=(0,O.g)(),a=(0,l.Fl)((()=>t.tooltip));return(e,t)=>{const n=(0,l.up)("q-card");return a.value.show?((0,l.wg)(),(0,l.iD)("svg",{key:0,x:a.value.x,y:a.value.y,class:"db-tooltip"},[((0,l.wg)(),(0,l.iD)("foreignObject",yt,[(0,l.Wm)(n,{class:"db-tooltip__content-card"},{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.j4)((0,l.LL)(a.value.component),(0,m.vs)((0,l.F4)(a.value.binds)),null,16))])),_:1})]))],8,bt)):(0,l.kq)("",!0)}}};var wt=a(4458);const ft=_t,xt=ft;U()(_t,"components",{QCard:wt.Z});const kt=["x","y"],Dt={x:"0",y:"0",width:"100%",height:"100%",class:"db-tooltip__content"},qt={__name:"VDbPanel",emits:["click:color"],setup(e,{emit:t}){const a=(0,O.g)();function n(e,...a){t("click:color",e,...a)}const i=(0,l.Fl)((()=>a.panel));return(e,t)=>{const a=(0,l.up)("q-card");return i.value.show?((0,l.wg)(),(0,l.iD)("svg",{key:0,x:i.value.x,y:i.value.y,class:"db-tooltip db-tooltip_panel"},[((0,l.wg)(),(0,l.iD)("foreignObject",Dt,[(0,l.Wm)(a,{class:"db-tooltip__content-card"},{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.j4)((0,l.LL)(i.value.component),(0,l.dG)(i.value.binds,{"onClick:colorBlock":n}),null,16))])),_:1})]))],8,kt)):(0,l.kq)("",!0)}}},Pt=qt,Mt=Pt;U()(qt,"components",{QCard:wt.Z});const Ct=["x","y"],St={x:"0",y:"0",width:"100%",height:"100%",class:"db-tooltip__content"},Tt={__name:"VDbRefPanel",emits:["click:cp"],setup(e,{emit:t}){const a=(0,O.g)();function n(e,...a){t("click:cp",e,...a)}const i=(0,l.Fl)((()=>a.refspanel));return(e,t)=>{const a=(0,l.up)("q-card");return i.value.show?((0,l.wg)(),(0,l.iD)("svg",{key:0,x:i.value.x,y:i.value.y,class:"db-tooltip db-tooltip_panel"},[((0,l.wg)(),(0,l.iD)("foreignObject",St,[(0,l.Wm)(a,{class:"db-tooltip__content-card"},{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.j4)((0,l.LL)(i.value.component),(0,l.dG)(i.value.binds,{"onClick:refCp":n}),null,16))])),_:1})]))],8,Ct)):(0,l.kq)("",!0)}}},Et=Tt,jt=Et;U()(Tt,"components",{QCard:wt.Z});const zt=["id","x","y","width","height"],Ht=["width","height"],$t=["width"],Zt={class:"db-tablegroup-header__name",y:"16"},Ut=["x2"],Rt={__name:"VDbTableGroup",props:{name:String,tables:Array,schema:Object,dbState:Object,id:Number,containerRef:Object},setup(e){const t=e,a=(0,O.g)(),i=(0,l.Fl)((()=>a.getTableGroup(t.id))),s=(0,n.iH)(null),o=(0,n.iH)([]),r=()=>{const e=t.tables.map((e=>a.getTable(e.id)));console.log(e);const l=e.reduce(((e,t)=>e?Math.min(e,t.x):t.x),0),n=e.reduce(((e,t)=>e?Math.max(e,t.x+t.width):t.x+t.width),0),s=e.reduce(((e,t)=>e?Math.min(e,t.y):t.y),0),o=e.reduce(((e,t)=>e?Math.max(e,t.y+t.height):t.y+t.height),0);console.log(l,n,s,o),i.value.x=l-20,i.value.y=s-20-35,i.value.width=Math.abs(n-l)+40,i.value.height=Math.abs(o-s)+40+35};(0,l.YP)((()=>t.tables),(e=>{o.value=t.tables.map((e=>a.getTable(e.id))),r()}),{deep:!0}),(0,l.bv)((()=>{o.value=t.tables.map((e=>a.getTable(e.id))),r()})),(0,l.YP)(o,(()=>{r()}),{deep:!0});const d=(0,n.iH)(!1),u=(0,n.iH)(!1),c=(0,n.iH)(null),h=(a.subGridSize,a.grid.snap),p=e=>{d.value=!0},v=e=>{d.value=!1,u.value=!1},g=({offsetX:e,offsetY:t})=>{const l=a.inverseCtm.transformPoint({x:e,y:t}),n=Ce(l.x-c.x,h),s=Ce(l.y-c.y,h),r=n-i.value.x,d=s-i.value.y;for(const a of o.value)a.x=a.x+r,a.y=a.y+d},b=e=>{u.value=!1,d.value=!1,c.x=null,c.y=null,t.containerRef.removeEventListener("mousemove",g,{passive:!0}),t.containerRef.removeEventListener("mouseup",b,{passive:!0}),t.containerRef.removeEventListener("mouseleave",v,{passive:!0})},y=({offsetX:e,offsetY:l})=>{u.value=!0;const n=a.inverseCtm.transformPoint({x:e,y:l});c.x=n.x-i.value.x,c.y=n.y-i.value.y,c.value=t.containerRef.createSVGPoint(),t.containerRef.addEventListener("mousemove",g,{passive:!0}),t.containerRef.addEventListener("mouseup",b,{passive:!0}),t.containerRef.addEventListener("mouseleave",v,{passive:!0})};return(t,a)=>((0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:s,id:`tablegroup-${e.id}`,class:(0,m.C_)({"db-tablegroup":!0,"db-tablegroup__highlight":d.value,"db-tablegroup__dragging":u.value}),x:i.value.x,y:i.value.y,width:i.value.width,height:i.value.height,onMouseenterPassive:p,onMouseleavePassive:v},[(0,l._)("rect",{class:"db-tablegroup__background",width:i.value.width,height:i.value.height},null,8,Ht),(0,l._)("g",{class:"db-tablegroup-header",onMousedownPassive:y},[(0,l._)("rect",{height:"30",width:i.value.width},null,8,$t),(0,l._)("text",Zt,(0,m.zw)(e.name),1),(0,l._)("title",null,(0,m.zw)(e.name),1),(0,l._)("line",{x1:"0",y1:"30",y2:"30",x2:i.value.width,class:"db-tablegroup-header__separator"},null,8,Ut)],32)],42,zt))}},Lt=Rt,Ot=Lt,At=["width","height","viewBox"],Yt=["width","height","viewBox"],Wt={class:"db-chart__bg-grid-small"},Ft=["d"],Nt=["d"],Bt=["width","height","viewBox"],It=["x","y","width","height"],Qt={id:"background-layer"},Gt=(0,l._)("rect",{class:"db-chart__bg-grid",x:"0",y:"0",width:"100%",height:"100%",fill:"url(#db-chart__bg-grid)"},null,-1),Vt={id:"viewport-layer"},Kt={key:0,id:"tablegroups-layer"},Xt={key:1,id:"refs-layer"},Jt={key:2,id:"tables-layer"},ea={key:3,id:"overlays-layer"},ta={key:4,id:"panel-overlays-layer"},aa={key:5,id:"panel-ref-overlays-layer"},la={id:"tools-layer"},na={x:"10",y:"10",width:"150",height:"36",class:"db-tools"},ia=(0,l._)("rect",{class:"db-tools__bg"},null,-1),sa=(0,l._)("text",{x:"0",class:"db-tools__header"},"position",-1),oa={x:"0"},ra={x:"75"},da={x:"170",y:"10",width:"150",height:"36",class:"db-tools"},ua=(0,l._)("rect",{class:"db-tools__bg"},null,-1),ca=(0,l._)("text",{x:"0",class:"db-tools__header"},"pan",-1),ha={x:"0"},pa={x:"75"},va={x:"330",y:"10",width:"100",height:"36",class:"db-tools"},ma=(0,l._)("rect",{class:"db-tools__bg"},null,-1),ga=(0,l._)("text",{x:"0",class:"db-tools__header"},"zoom",-1),ba={x:"0"},ya={__name:"VDbChart",props:{tableGroups:{type:Array,default:()=>[]},tables:{type:Array,default:()=>[]},refs:{type:Array,default:()=>[]},schemes:{type:Array,default:()=>[]},startpan:{x:0,y:0}},emits:["dblclick:table-group","dblclick:table","dblclick:ref","dblclick:field"],setup(e,{emit:t}){const a=e,i=(0,O.g)(),s=(0,n.iH)(null),o=((0,n.iH)(null),(0,n.iH)(null)),r=(0,l.Fl)((()=>a.schemes.length>1)),d=(0,n.qj)({pattern:{viewport:{x:0,y:0,width:100,height:100},rect:{x:-100,y:-100,width:300,height:300},path:"",x:0,y:0,width:100,height:100},offset:{x:0,y:0}}),u=(0,n.iH)({}),c=(0,n.qj)({x:0,y:0});let h=!1;const p=e=>{const t=i.inverseCtm.transformPoint({x:e.offsetX,y:e.offsetY});c.x=t.x,c.y=t.y},v=()=>{const e=u.value.getSizes(),t=u.value.getPan(),a=u.value.getZoom(),l={x:t.x-e.width/2,y:t.y-e.height/2};i.$patch({pan:l,zoom:a})},m=()=>{u.value.getSizes();const e=i.pan,t=i.zoom,a={x:e.x,y:e.y};u.value.resize(),u.value.center(),u.value.zoom(t),u.value.panBy(a)};function g(e){let t="";const{size:a,divisions:l}=i.grid,n=DOMMatrix.fromMatrix(e),s=n.transformPoint({x:0,y:0}),o=n.transformPoint({x:a,y:a}),r=Math.abs(o.x-s.x),u=Math.abs(o.y-s.y),c=r/l,h=u/l,p=s.x,v=s.y,m=(p%r+r)%r,g=(v%u+u)%u;t+="M 0 0";for(let i=1;i<l;i++)t+=` m ${c*i} 0 l 0 ${u} m -${c*i} -${u}`;t+="M 0 0";for(let i=1;i<l;i++)t+=` m 0 ${h*i} l ${r} 0 m -${r} -${h*i}`;d.pattern.x=-m,d.pattern.y=-g,d.pattern.width=r,d.pattern.height=u,d.pattern.path=t}const b=e=>{i.updateCTM(e),g(e)},y=()=>{v()};function _(e,a){console.log("onRefDblClick",e,a),t("dblclick:ref",e,a)}function w(e,t,a,l,n){let s=i.getRef(n);"RESET"==t&&(s.vertices=[]),"ADD"==t&&s.vertices.splice(s.vertices.length-1,0,{x:a.x,y:a.y}),"DEL"==t&&s.vertices.length>2&&s.vertices.splice(Number(l),1),i.updateRef(n,s),i.hideRefPanel()}function f(e,t,a,l,n){i.updateTableColor(a,t,l,n),i.hidePanel()}function x(e,a){console.log("onFieldDblClick",e,a),t("dblclick:field",e,a)}function k(e,a){console.log("onTableDblClick",e,a),t("dblclick:table",e,a)}function D(e,a){console.log("onTableGroupDblClick",e,a),t("dblclick:table-group",e,a)}function q(e){e.target.parentElement.appendChild(e.target)}function P(e){}function M(e){e.target.parentElement.appendChild(e.target)}function C(e){}function S(e){e.target.parentElement.appendChild(e.target)}function T(e){}(0,l.bv)((()=>{u.value=gt()(s.value,{viewportSelector:"#viewport-layer",panEnabled:!1,fit:!1,center:!1,dblClickZoomEnabled:!1,zoomScaleSensitivity:.3,minZoom:.1,maxZoom:2}),(0,l.Y3)((()=>{m(),u.value.disablePan(),u.value.setOnPan((()=>v())),u.value.setOnZoom((()=>y())),u.value.setOnUpdatedCTM((e=>b(e)))})),h=!0})),(0,l.YP)((()=>a.tables),(()=>{u.value.updateBBox()})),(0,l.YP)((()=>a.refs),(()=>{u.value.updateBBox()})),(0,l.YP)((()=>i.zoom),(e=>{u.value.zoom(e)})),(0,l.YP)((()=>a.startpan),(e=>{let t=u.value.getSizes(),l=i.zoom,n=1,s=1,o=.04;e.diagram.height>t.height&&(n=t.height/e.diagram.height),e.diagram.width>t.width&&(s=t.width/e.diagram.width);const r=u.value.getPan(),d={x:r.x-t.width/2,y:r.y-t.height/2};l=Math.min(s,n)-o,console.log("sizes",t,"start pan ",a.startpan,"zooms",l,s,n),i.$patch({pan:d,zoom:l}),u.value.center(),u.value.zoom(l)}));let E=Date.now(),j=null;function z(e,t,...a){console.log("dblclickHelper",t,...a);const l=Date.now();l-E<500&&j===t.target&&(console.log("dblclickHelperYES",t,...a),e(t,...a)),j=t.target,E=l}return(t,a)=>{const h=(0,l.up)("v-number");return(0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:s,class:"db-chart",onMousemovePassiveCapture:p,width:t.width,height:t.height,viewBox:t.viewBox,"shape-rendering":"optimizeSpeed","text-rendering":"optimizeSpeed"},[(0,l._)("defs",null,[(0,l._)("pattern",{id:"db-chart__bg-grid-base",width:d.pattern.width,height:d.pattern.height,patternUnits:"userSpaceOnUse",viewBox:`0 0 ${d.pattern.width} ${d.pattern.height}`,class:"db-chart__bg-grid",ref_key:"bgGridRect",ref:o},[(0,l._)("g",Wt,[(0,l._)("path",{d:d.pattern.path,fill:"none"},null,8,Ft)]),(0,l._)("path",{d:`M ${d.pattern.width} 0 L 0 0 0 ${d.pattern.height}`,fill:"none"},null,8,Nt)],8,Yt),(0,l._)("pattern",{id:"db-chart__bg-grid",x:"0",y:"0",width:d.pattern.width,height:d.pattern.height,patternUnits:"userSpaceOnUse",viewBox:`${d.pattern.x} ${d.pattern.y} ${d.pattern.width} ${d.pattern.height}`},[(0,l._)("rect",{x:`-${d.pattern.width}`,y:`-${d.pattern.height}`,width:""+3*d.pattern.width,height:""+3*d.pattern.height,fill:"url(#db-chart__bg-grid-base)"},null,8,It)],8,Bt)]),(0,l._)("g",Qt,[(0,l._)("rect",{ref:"bgRef",class:"db-chart__bg",onMousedown:a[0]||(a[0]=e=>u.value.enablePan()),onMouseup:a[1]||(a[1]=e=>u.value.disablePan()),onTouchend:a[2]||(a[2]=e=>u.value.disablePan())},null,544),Gt]),(0,l._)("g",Vt,[(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Kt,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.tableGroups,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(Ot),(0,l.dG)({key:e.id},e,{"container-ref":s.value,onClickPassive:t=>z(D,t,e),onMouseenterPassive:S,onMouseleavePassive:T}),null,16,["container-ref","onClickPassive"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Xt,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.refs,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(vt),(0,l.dG)({key:e.id},e,{"container-ref":s.value,"onClick:ref":t=>z(_,t,e),onClickPassive:t=>z(_,t,e),onMouseenterPassive:q,onMouseleavePassive:P}),null,16,["container-ref","onClick:ref","onClickPassive"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Jt,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.tables,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(Je),(0,l.dG)(e,{useSchema:r.value,key:e.id,"container-ref":s.value,"onClick:header":t=>z(k,t,e),"onClick:field":a[3]||(a[3]=(...e)=>z(x,...e)),onMouseenterPassive:M,onMouseleavePassive:C}),null,16,["useSchema","container-ref","onClick:header"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",ea,[(0,l.Wm)((0,n.SU)(xt))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",ta,[(0,l.Wm)(Mt,{"onClick:color":f,onTouchendPassive:f})])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",aa,[(0,l.Wm)(jt,{"onClick:cp":w,onTouchendPassive:w})])):(0,l.kq)("",!0)]),(0,l._)("g",la,[((0,l.wg)(),(0,l.iD)("svg",na,[ia,sa,(0,l._)("text",oa,[(0,l.Uk)("x: "),(0,l.Wm)(h,{value:c.x,decimals:"1"},null,8,["value"])]),(0,l._)("text",ra,[(0,l.Uk)("y: "),(0,l.Wm)(h,{value:c.y,decimals:"1"},null,8,["value"])])])),((0,l.wg)(),(0,l.iD)("svg",da,[ua,ca,(0,l._)("text",ha,[(0,l.Uk)("x: "),(0,l.Wm)(h,{value:(0,n.SU)(i).pan.x,decimals:"1"},null,8,["value"])]),(0,l._)("text",pa,[(0,l.Uk)("y: "),(0,l.Wm)(h,{value:(0,n.SU)(i).pan.y,decimals:"1"},null,8,["value"])])])),((0,l.wg)(),(0,l.iD)("svg",va,[ma,ga,(0,l._)("text",ba,[(0,l.Wm)(h,{value:(0,n.SU)(i).zoom,decimals:"3"},null,8,["value"])])]))])],40,At)}}},_a=ya,wa=_a;a(8423);const fa={__name:"VDbStructure",props:{database:Object},setup(e){const t=e,a=(0,l.Fl)((()=>{const e=t.database;return e.schemas.map((e=>({id:`schema-${e.id}`,icon:"schema",label:e.name,children:[{id:`schema-${e.id}-tables`,icon:"source",label:"Tables",children:e.tables.map((e=>({id:`table-${e.id}`,icon:"table-view",label:e.name,children:[{id:`table-${e.id}-fields`,icon:"",label:"Columns",children:e.fields.map((e=>({id:`field-${e.id}`,icon:"",label:e.name})))}]})))}]})))}));return(e,t)=>{const n=(0,l.up)("q-tree");return(0,l.wg)(),(0,l.j4)(n,{"node-key":"id",nodes:a.value,dense:""},null,8,["nodes"])}}};var xa=a(756);U()(fa,"components",{QTree:xa.Z});const ka={class:"dbml-graph-wrapper"},Da={class:"dbml-toolbar-wrapper"},qa={class:"q-mx-sm non-selectable",style:{width:"2.5rem",flex:"0 0 auto"}},Pa={__name:"DbmlGraph",props:{schema:{type:Object,required:!0}},emits:["update:positions"],setup(e,{emit:t}){const a=(0,r.E)(),i=(0,O.g)(),s=(0,n.iH)({pan:{x:0,y:0},diagram:{width:0,height:0}}),o=(e,t)=>{if(console.log("locateInEditor",e,t),t){const e=t.token;a.updateSelectionMarker(e.start,e.end)}console.log,i.hideTooltip(),Date.now()-i.panel.datetime>500&&i.hidePanel(),Date.now()-i.panel.datetime>500&&i.hideRefPanel()},d=(0,l.Fl)({get(){return 100*(i.zoom||1)},set(e){const t=e/100;i.updateZoom(t)}}),u=(0,n.iH)(10),c=(0,n.iH)(200),h=()=>{const e=i.getTables;var t=Object.keys(e),a=[];let l=!1;for(let i of t)a.push(Object.values(e[i]));for(let s=0;s<a.length;s++){var n=[];if(l){const e=i.getTables;t=Object.keys(e);a=[];for(let l of t)a.push(Object.values(e[l]))}let e=p(a[s]);for(let t=0;t<a.length;t++)if(t!==s&&(n=v(e,p(a[t])),n[0]||n[1]||n[2]||n[3]))break;n[0]&&(a[s][0]=a[s][0]+2*a[s][2]),n[1]&&(a[s][0]=a[s][0]-2*a[s][2],a[s][1]=a[s][1]+.8*a[s][3]),n[2]&&(a[s][0]=a[s][0]-2*a[s][2],a[s][1]=a[s][1]-.8*a[s][3]),n[3]&&(a[s][0]=a[s][0]+2*a[s][2],a[s][1]=a[s][1]-.8*a[s][3]),(n[0]||n[1]||n[2]||n[3])&&(l=!0,i.updateTable(s+1,{x:a[s][0],y:a[s][1],width:a[s][2],height:a[s][3]}))}},p=e=>[[e[0],e[1]],[e[0]+e[2],e[1]],[e[0]+e[2],e[1]+e[3]],[e[0],e[1]+e[3]]],v=(e,t)=>{let a=[!1,!1,!1,!1],l=[!1,!1,!1,!1];for(let n=0;n<e.length;n++){l=[!1,!1,!1,!1];for(let a=0;a<t.length;a++)0==a&&(t[a][0]<=e[n][0]&&t[a][1]<=e[n][1]?l[0]=!0:l[0]=!1),1==a&&(t[a][0]>=e[n][0]&&t[a][1]<=e[n][1]?l[1]=!0:l[1]=!1),2==a&&(t[a][0]>=e[n][0]&&t[a][1]>=e[n][1]?l[2]=!0:l[2]=!1),3==a&&(t[a][0]<=e[n][0]&&t[a][1]>=e[n][1]?l[3]=!0:l[3]=!1);a[n]=l[0]&&l[1]&&l[2]&&l[3]}return a};function g(e,t,a=!1){for(let l in t)t[l].x<e.l&&(e.l=t[l].x),t[l].y<e.t&&(e.t=t[l].y),a||(t[l].x+t[l].width>e.r&&(e.r=t[l].x+t[l].width),t[l].y+t[l].height>e.b&&(e.b=t[l].y+t[l].height));return e}const b=()=>{let e=g({l:0,r:0,t:0,b:0},i.getTables),t=i.getZoom;s.value={pan:{x:t*((e.r+e.l)/2),y:t*((e.t+e.b)/2)},diagram:{width:0,height:0}},s.value={pan:{x:s.value.pan.x,y:s.value.pan.y},diagram:{width:Math.abs(e.r)+Math.abs(e.l),height:Math.abs(e.t)+Math.abs(e.b)}},i.updatePan(s.value)};return(t,a)=>{const r=(0,l.up)("q-card"),p=(0,l.up)("q-btn"),v=(0,l.up)("q-space"),g=(0,l.up)("q-slider"),y=(0,l.up)("q-toolbar");return(0,l.wg)(),(0,l.iD)("div",ka,[e.schema&&(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.j4)((0,n.SU)(wa),(0,l.dG)({key:0},e.schema,{startpan:s.value,onClick:o,"onDblclick:tableGroup":o,"onDblclick:table":o,"onDblclick:field":o,"onDblclick:ref":o}),null,16,["startpan"])):(0,l.kq)("",!0),(0,l.kq)("",!0),(0,l._)("div",Da,[(0,l.Wm)(r,{class:"shadow-6"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{class:"rounded-borders"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{class:"q-mr-xs q-px-md",color:"secondary",dense:"",onClick:h},{default:(0,l.w5)((()=>[(0,l.Uk)(" Auto-Layout ")])),_:1}),(0,l.Wm)(p,{class:"q-mx-xs q-px-md",color:"secondary",dense:"",onClick:b},{default:(0,l.w5)((()=>[(0,l.Uk)(" fit ")])),_:1}),(0,l.Wm)(v),(0,l.Wm)(g,{class:"q-mx-sm",style:{width:"25%","min-width":"100px","max-width":"200px"},modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),min:u.value,max:c.value,step:.1,immediate:!0},null,8,["modelValue","min","max"]),(0,l._)("div",qa,(0,m.zw)(Math.round(d.value))+" % ",1)])),_:1})])),_:1})])])}}};var Ma=a(1663),Ca=a(8879),Sa=a(136),Ta=a(4278);const Ea=(0,h.Z)(Pa,[["__scopeId","data-v-76de6449"]]),ja=Ea;U()(Pa,"components",{QCard:wt.Z,QToolbar:Ma.Z,QBtn:Ca.Z,QSpace:Sa.Z,QSlider:Ta.Z});var za=a(9302);const Ha={__name:"Index",setup(e){const t=(0,n.iH)(null),a=(0,r.E)();(0,za.Z)();function i(e){if(1===e.touches.length){var t=e.changedTouches[0],a=document.createEvent("MouseEvent");a.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(a)}}function s(e){if(2===e.touches.length){e.preventDefault();const t=e.touches[0],a=e.touches[1],l=(t.clientX+a.clientX)/2,n=(t.clientY+a.clientY)/2,i=document.createEvent("MouseEvent");i.initMouseEvent("mousemove",!0,!0,window,0,0,0,l,n,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}(0,l.bv)((()=>{document.addEventListener("touchstart",i,{passive:!1}),document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("touchend",i,{passive:!1}),document.addEventListener("touchcancel",i,{passive:!1}),document.addEventListener("touchstart",s,{passive:!1}),document.addEventListener("touchmove",s,{passive:!1})}));const o=(0,l.Fl)({get:()=>a.getSourceText,set:e=>a.updateSourceText(e)}),d=((0,l.Fl)({get:()=>a.getPreferences,set:e=>a.updatePreferences(e)}),(0,l.Fl)({get:()=>a.getSplit,set:e=>a.updateSplit(e)})),u=(0,l.Fl)((()=>{var e={tableGroups:[],tables:[],refs:[],schemes:[]};return a.getDatabase?.schemas?.forEach((t=>{e.schemes.push({id:t.id,name:t.name}),e.tableGroups=e.tableGroups.concat(t.tableGroups),e.tables=e.tables.concat(t.tables),e.refs=e.refs.concat(t.refs)})),e}));return(e,a)=>{const i=(0,l.up)("q-splitter"),s=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(s,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),limits:[10,75],class:"editor-wrapper"},{before:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(v),{ref_key:"editorRef",ref:t,class:"db-code-editor",source:o.value,"onUpdate:source":a[0]||(a[0]=e=>o.value=e)},null,8,["source"])])),after:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(ja),{class:"db-graph-view",schema:u.value},null,8,["schema"])])),_:1},8,["modelValue"])])),_:1})}}};var $a=a(9885),Za=a(7498);const Ua=(0,h.Z)(Ha,[["__scopeId","data-v-1ffe2dfa"]]),Ra=Ua;U()(Ha,"components",{QPage:$a.Z,QSplitter:Za.Z})}}]);